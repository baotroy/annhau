(function(a){function b(b,c){function bb(a){var b=document.getElementById("l");b.innerHTML=a}var f,r,s,e=jQuery.extend({},{php:"",id:"",title:"",displaymode:!1,debug:!1,skin:"skins/skin.png",stars:5,step:1,round:!0,cursor:"pointer",load:!0,enable:!0,animate:!1,easing:5,showtext:!0,textlocation:"bottom",minvotes:0,textstart:"rate to see statistics",textloading:"...loading",textminvotes:"%r votes required",textmain:"%ms / %maxs (from %v votes)",texthover:"very bad|bad|average|good|perfect",textthanks:"thank you",textdelay:1500,ondata:function(){},onmove:function(){},onlieve:function(){},onclick:function(){}},c),g=Array(),h=-1,i=0,j=0,k=0,m="stars_"+Math.floor(1e4*Math.random())+"_"+(new Date).getTime()+"_"+Math.floor(1e4*Math.random()),n=-1,o=0,p=0,q=0,t=!1,u=!1,v=!0,w=!1,x=function(){_(),P(),F(),I(),y()},y=function(){if(e.displaymode)return e.enable=!1,v=!1,I(),A(q+"|"+o+"|99999|",!1),void 0;if(1!=arguments[0]&&1!=e.load)return G(e.textstart),void 0;if(""==e.php||""==e.id){if(""!=e.id){if(z()){if(arguments[0])o=Math.min(Math.max(p,0),100),localStorage.setItem(e.id,o),q=1;else{var b=localStorage.getItem(e.id);b?(o="string"==typeof b?Y(b):b,q=1):(o=0,q=0)}return A(q+"|"+o+"|"+(arguments[0]?e.textdelay/1e3:0)+"|",arguments[0]?!0:!1),void 0}return t=!0,F(),void 0}return t=!0,F(),void 0}E();var c=!1,d="?id="+encodeURIComponent(e.id);""!=e.title&&(d+="&i="+encodeURIComponent(e.title)),arguments[0]&&(d+="&r="+Math.min(Math.max(p,0),100),c=!0),d+="&ref="+encodeURIComponent(document.URL),d+="&rnd="+((new Date).getMilliseconds()+"_"+Math.floor(1e3*Math.random())),a.ajax({type:"POST",url:e.php+d,dataType:"text",contentType:"charset=utf-8",data:"",done:function(a){A(a,c)},fail:function(a,b,c){G("PHP problem | "+e.php+" | "+c,e.debug),E()},success:function(a){A(a,c)},error:function(a,b,c){G("PHP problem | "+e.php+" | "+c,e.debug),E()}})},z=function(){try{return"object"==typeof window.localStorage}catch(a){return!1}},A=function(a,b){E();var c=a.split("|");if(""!=c[3]&&c[3]!==void 0)G("Error: "+c[3],e.debug),"function"==typeof e.ondata&&e.ondata({id:e.id,value:o,votes:q,error:c[3]});else{if(t=!0,q=parseInt(c[0]),o=parseFloat(c[1]),Q(),g[1].target=q>=e.minvotes?V(o):0,e.animate||(g[1].value=g[1].target),b&&e.textdelay>0?setTimeout(P,e.textdelay):P(),F(),v){c[2]=parseInt(c[2]);var d=c[2]>500?5e5:Math.max(0,1e3*c[2]);b&&e.textdelay>0&&(d=Math.max(d,e.textdelay)),d>0?setTimeout(D,d):D()}"function"==typeof e.ondata&&e.ondata({id:e.id,value:o,votes:q,error:""})}},C=function(){u=!1,F()},D=function(){e.enable=!0,I()},E=function(){e.enable=!1,I()},F=function(){var a;u&&e.textdelay>0?(a=e.textthanks,setTimeout(C,e.textdelay)):a=t?e.minvotes>q?e.textminvotes:e.textmain:e.load?e.textloading:e.textstart,G(a)},G=function(a){e.showtext&&arguments[1]!==!1&&(a=H(a),w&&r.html(a))},H=function(a){return"string"!=typeof a?a:(a=a.replace(/%v/gi,q),a=a.replace(/%ms/gi,Math.round(10*W(o))/10),a=a.replace(/%ps/gi,Math.round(10*W(p))/10),a=a.replace(/%maxs/gi,e.stars),a=a.replace(/%m/gi,Math.round(V(o))),a=a.replace(/%p/gi,Math.round(V(p))),a=a.replace(/%rr/gi,e.minvotes-q),a=a.replace(/%r/gi,e.minvotes))},I=function(){a("#"+m).unbind("mouseover",N),a("#"+m).unbind("mousemove",J),a("#"+m).unbind("mousedown",L),a("#"+m).unbind("mouseup",K),a("#"+m).unbind("mouseleave",M),1==e.enable&&(a("#"+m).bind("mouseover",N),a("#"+m).bind("mousemove",J),a("#"+m).bind("mousedown",L),a("#"+m).bind("mouseup",K),a("#"+m).bind("mouseleave",M)),a("#"+m).css("cursor",e.enable?e.cursor:"auto")},J=function(b){var c=a("html").scrollLeft();c||(c=a("body").scrollLeft());var d=b.clientX-a("#"+m).offset().left+c;d>i?d=i:0>d&&(d=0),d=T(d);var f=100*d/i;if(p=Math.round(10*f)/10,e.showtext){var g=s.length;if(g>=1){var h=Math.ceil(f*g/100)-1;h=0>h?0:h>g-1?g-1:h,G(s[h])}}R(1,0,!1,!0),R(2,d,!1),n!=f&&"function"==typeof e.onmove&&(n=f,e.onmove(f))},K=function(a){E(),L(a),u=!0,F(),n=-1,y(!0),"function"==typeof e.onclick&&e.onclick(p)},L=function(){g[1].target=e.minvotes>q?0:o,g[1].value=p,R(2,0,!1,!0),S(1,p,e.step>0&&e.round)},M=function(){F(),g[1].target=e.minvotes>q?0:V(o);var b;e.animate?(g[1].value=p,b=p):(g[1].value=g[1].target,b=o),n=-1,R(2,0,!1,!0),S(1,e.minvotes>q?0:b,e.step>0&&e.round),P(),"function"==typeof e.onlieve&&e.onlieve()},N=function(a){Q(),R(1,0,!1,!0),J(a)},O=function(){for(var a,b=0,c=1;2>c;c++)a=g[c].target-g[c].value,0==a?b++:g[c].value+=1>Math.abs(a)?a:0>=e.easing?a:a/(1+e.easing),S(c,g[c].value,e.step>0&&e.round);1==b&&Q()},P=function(){-1==h&&(S(1,g[1].value,e.step>0&&e.round),h=setInterval(O,20))},Q=function(){clearInterval(h),h=-1},R=function(a,b,c,d){1==c&&(b=U(b)),b=Math.min(Math.round(b),i*e.stars),f[a].style.width=b+"px",a>0&&!d&&(f[0].style.backgroundPosition=-b+"px 0",f[0].style.left=b+"px",f[0].style.width=i-b+"px")},S=function(a,b,c){b=Math.round(i*b/100),R(a,b,c)},T=function(a){return e.step>0?Math.ceil(a/(j*e.step))*j*e.step:a},U=function(a){return e.step>0?Math.round(a/(j*e.step))*j*e.step:a},V=function(a){return e.round?100*U(a*i/100)/i:a},W=function(a){return e.step>0&&e.round?Math.round(a*i/(100*j*e.step))*e.step:a*i/(100*j)},X=function(){if(""==e.id){var a=b.attr("id");void 0!=a&&(e.id=a)}for(var c in e)e.hasOwnProperty(c)&&"function"!=typeof e[c]&&(settings_string=b.data(c),"undefined"!=typeof settings_string&&("string"==typeof settings_string?(settings_string=settings_string.replace("/	\n\r/i",""),settings_string=settings_string.replace(/^\s+|\s+$/g,""),e[c]=Y(settings_string)):e[c]=settings_string,Z(c)));if(settings_string=b.data("value"),"undefined"!=typeof settings_string&&""!=settings_string&&(o=parseFloat(settings_string),o=0>o?0:o>100?100:o),settings_string=b.data("votes"),"undefined"!=typeof settings_string&&""!=settings_string&&(q=parseInt(settings_string),q=0>q?0:q),settings_string=b.data("settings"),"undefined"!=typeof settings_string&&""!=settings_string){settings_string=settings_string.replace("/	\n\r/i","");for(var d=settings_string.split(";"),f=0;d.length>f;f++){var g=d[f].split(":");g[0]=g[0].replace(/\s/g,""),e[g[0]]!==void 0&&g.length>=2&&(g[1]=g[1].replace(/^\s+|\s+$/g,""),e[g[0]]=Y(g[1]),Z(g[0]))}}Z("enable"),Z("texthover")},Y=function(a){var b=a.toLowerCase();return b=="false"+""||b=="no"+""?!1:b=="true"+""||b=="yes"+""?!0:0==isNaN(parseFloat(a))?parseFloat(a):a},Z=function(a){switch(a){case"easing":0>e.easing&&(e.easing=0);break;case"step":0>e.step&&(e.step=0);break;case"stars":0>e.stars&&(e.stars=0);break;case"minvotes":0>e.minvotes&&(e.minvotes=0);break;case"textdelay":0>e.textdelay&&(e.textdelay=0);break;case"texthover":"string"==typeof e.texthover?s=e.texthover.split("|"):(s=[],s[0]=""+e.texthover);break;case"enable":v=e.enable}},$=function(c){w=!1,a('<img "/>');var f=e.skin.split("|")[0],g=new Image;g.onload=function(){j=this.width,k=this.height,0!=j&&0!=k||!e.debug?c?(_(!0),F(),P(),I()):x():(r=a('<div class="rating-text" style="z-index:3;">detected skin '+f+" size "+j+"x"+k+" please check the path to skin file.</div>"),b.empty(),b.append(r))},g.onerror=function(){e.debug&&(r=a('<div class="rating-text" style="z-index:3;">cannot load skin '+f+". Please check the path to skin file.</div>"),b.empty(),b.append(r))},g.src=f},_=function(c){var d=e.skin.split("|"),h=1==d.length?!0:!1,l=parseInt(k/(h?3:1));i=e.stars*j;var n=b.css("position");"static"==n&&b.css("position","relative"),d[0]=d[0].replace(/^\s+|\s+$/g,""),d[1]=2>d.length?d[0]:d[1].replace(/^\s+|\s+$/g,""),d[2]=3>d.length?d[1]:d[2].replace(/^\s+|\s+$/g,"");var p="position:absolute;top:0px;left:0px;padding:0;margin:0;background:",s='<div id="'+m+'" style="display:block;position:relative;overflow:hidden;width:'+i+"px;height:"+l+'px;top:0px;left:0px;">';if(s+='<div style="'+p+"url("+d[0]+") repeat-x;width:"+i+"px;height:"+l+'px;z-index:0;"></div>',s+='<div style="'+p+"url("+d[1]+") 0px "+(h?-l:0)+"px repeat-x;width:0px;height:"+l+'px;z-index:1;"></div>',s+='<div style="'+p+"url("+d[2]+") 0px "+(h?2*-l:0)+"px repeat-x;width:0px;height:"+l+'px;z-index:2;"></div>',s+="</div>",r=a('<div class="rating-text" style="z-index:3;"></div>'),"top"!=e.textlocation&&"bottom"!=e.textlocation){var t=a("#"+e.textlocation);1==t.length?r=t:e.textlocation="bottom"}b.empty(),"top"==e.textlocation?b.append(r,s):"bottom"==e.textlocation?b.append(s,r):b.append(s),f=a("#"+m).children("div");var u=q>=e.minvotes||o>0&&!w?o:0;g[1]=1==c?{value:u,target:u}:{value:e.animate?0:u,target:u},0==e.stars&&(b.css("height","0px"),i=1),"static"==n&&b.css("position","static"),w=!0},ab=function(){Q(),o=0,p=0,q=0,t=!1,u=!1,y()};this.option=function(c,d){if(c!==void 0){if(c=c.replace(/^\s+|\s+$/g,""),e[c]===void 0)return b;if(d===void 0)return e[c];if("string"==typeof d?(d=d.replace(/^\s+|\s+$/g,"").toLowerCase(),e[c]=Y(d)):"boolean"==typeof d?e[c]=d:"number"==typeof d&&(e[c]=d),Z(c),"enable"==c&&w)I();else if("cursor"==c&&w)a("#"+m).css("cursor",e.enable?e.cursor:"auto");else if("id"==c)ab();else if("showtext"==c&&w)e.showtext?F():r.html("");else if("skin"==c)$(!0);else if(!w||"round"!=c&&"step"!=c)if("textlocation"==c&&w)if("top"==e.textlocation)r.prependTo(b);else if("bottom"==e.textlocation)r.appendTo(b);else{var f=a("#"+e.textlocation);1==f.length&&r.appendTo(f)}else if("stars"==c&&w){i=e.stars*j,a("#"+m)[0].style.width=i+"px",F();var h=g[1].value;g[1].value=0,P(),g[1].value=h}else"load"==c&&w?(t=!1,F()):1==e.showtext&&w&&"text"==c.substr(0,4)&&F();else g[1].target=q>=e.minvotes?V(o):0,e.animate||(g[1].value=g[1].target),F(),P();return b}},this.value=function(a){return a===void 0?o:(a=0>a?0:a>100?100:a,g[1]={target:a,value:o},o=a,F(),1==arguments[1]&&(g[1].value=a),w&&P(),b)},this.votes=function(a){return a===void 0?q:(a=0>a?0:a,q=a,F(),b)},this.id=function(a){return a===void 0?e.id:(e.id=a,ab(),b)},bb(""),X(),$(!1)}var c="rating";a.fn[c]=function(d){if(0==this.length)return!1;var e=arguments[0];if("string"==typeof e){var f=Array.prototype.slice.call(arguments,1);if("string"==typeof e){var g=a(this),h=g.data(c);if("function"==typeof h[d])return h[d].apply(g[0],f)}}else if("object"==typeof d||!d)return this.each(function(){var e=a(this);return e.data(c),"object"!=typeof d&&d?void 0:e.data(c,new b(e,d))})}})(jQuery);